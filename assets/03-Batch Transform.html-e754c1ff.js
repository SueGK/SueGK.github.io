import{ad as t,G as o,H as r,E as n,S as a,N as i,ae as s,W as p}from"./framework-48bbaeac.js";const c={},l=s(`<hr><h2 id="title-03-batch-transformarticle-false" tabindex="-1"><a class="header-anchor" href="#title-03-batch-transformarticle-false" aria-hidden="true">#</a> title: 03-Batch Transform article: false</h2><h3 id="batch-transform" tabindex="-1"><a class="header-anchor" href="#batch-transform" aria-hidden="true">#</a> Batch Transform</h3><p>Use batch transform when you need to do the following:</p><ul><li>Preprocess datasets to remove noise or bias that interferes with training or inference from your dataset.</li><li>Get inferences from large datasets.</li><li>Run inference when you don&#39;t need a persistent endpoint.</li><li>Associate input records with inferences to assist the interpretation of results.</li></ul><p><strong>Batch Transform</strong> is a compute job that performs inference on a dataset. To invoke Batch Transform, you will need the following:</p><ul><li>Input path in S3 to the bucket containing the datasets.</li><li>Output path in S3 for the result of the inference.</li><li>Description of computing resources</li><li>S3 URI of the model artifact.</li></ul><p><strong>A Batch Transformation job is only possible on models created through the AWS Console or through the “CreateModel” operation on the CLI or SDK.</strong></p><p>This differs from an endpoint in that endpoints service individual user requests for inference over time.</p><h3 id="batch-transform-in-parallel" tabindex="-1"><a class="header-anchor" href="#batch-transform-in-parallel" aria-hidden="true">#</a> Batch Transform (in parallel)</h3><p>The size of data can be a bottleneck for a transform job. By default, a separate compute resource will be spun up for each individual file in the S3 bucket that you specify. If you wish to split the size of the job even further, you can set the <code>SplitType</code> parameter to <code>&quot;Line&quot;</code>. To assemble these split jobs back to a single output file, set <code>AssembleWith</code> parameters to <code>&quot;Line&quot;</code>.</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> boto3
client <span class="token operator">=</span> boto3<span class="token punctuation">.</span>client<span class="token punctuation">(</span>‘sagemaker’<span class="token punctuation">)</span>
response <span class="token operator">=</span> client<span class="token punctuation">.</span>create_transform_job<span class="token punctuation">(</span>
    TransformJobName<span class="token operator">=</span>‘my_job’<span class="token punctuation">,</span>
    ModelName<span class="token operator">=</span>‘target_model_for_inference’<span class="token punctuation">,</span>
    TransformInput<span class="token operator">=</span><span class="token punctuation">{</span>
        ‘DataSource’<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            ‘S3DataSource’<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            ‘S3DataType’<span class="token punctuation">:</span> ‘S3Prefix’<span class="token punctuation">,</span>
            ‘S3Uri’<span class="token punctuation">:</span> ‘s3<span class="token punctuation">:</span><span class="token operator">//</span>mybucket<span class="token operator">/</span>inputfolder<span class="token operator">/</span>’
         <span class="token punctuation">}</span>
     <span class="token punctuation">}</span><span class="token punctuation">,</span>
    ‘SplitType’<span class="token punctuation">:</span> ‘Line’
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    TransformInput<span class="token operator">=</span><span class="token punctuation">{</span>
        ‘S3OutputPath’<span class="token punctuation">:</span> ‘s3<span class="token punctuation">:</span><span class="token operator">//</span>mybucket<span class="token operator">/</span>outputpath’<span class="token punctuation">,</span>
        ‘AssembleWith’<span class="token punctuation">:</span> ‘Line’
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    TransformResources<span class="token operator">=</span><span class="token punctuation">{</span>
    &#39;InstanceType’<span class="token punctuation">:</span> ‘ml<span class="token punctuation">.</span>m4<span class="token punctuation">.</span>xlarge’<span class="token punctuation">,</span>
    ‘InstanceCount’<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="new-terms" tabindex="-1"><a class="header-anchor" href="#new-terms" aria-hidden="true">#</a> New Terms</h3><ul><li><strong>Batch Transform</strong> - A compute job that performs inference on a dataset.</li></ul><h3 id="additional-resources" tabindex="-1"><a class="header-anchor" href="#additional-resources" aria-hidden="true">#</a> Additional Resources</h3>`,15),u={href:"https://docs.aws.amazon.com/sagemaker/latest/dg/batch-transform.html",target:"_blank",rel:"noopener noreferrer"},d=s(`<h1 id="batch-transform-demo" tabindex="-1"><a class="header-anchor" href="#batch-transform-demo" aria-hidden="true">#</a> Batch Transform Demo</h1><h2 id="sdk" tabindex="-1"><a class="header-anchor" href="#sdk" aria-hidden="true">#</a> SDK</h2><p>Programmatically, we do this operation in a similar pattern to what we’re used to. First, we’ll create a <strong>boto3 session.</strong> Then, similar to our operations on endpoints, we create a model object utilizing the i<strong>mage uri</strong> of Amazon’s XGBoost, our <strong>model artifact</strong>, and an <strong>execution role</strong>.</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>role <span class="token operator">=</span> get_execution_role<span class="token punctuation">(</span><span class="token punctuation">)</span>
image_uri <span class="token operator">=</span> image_uris<span class="token punctuation">.</span>retrieve<span class="token punctuation">(</span>framework<span class="token operator">=</span><span class="token string">&#39;xgboost&#39;</span><span class="token punctuation">,</span>region<span class="token operator">=</span><span class="token string">&#39;us-west-2&#39;</span><span class="token punctuation">,</span> version<span class="token operator">=</span><span class="token string">&#39;latest&#39;</span><span class="token punctuation">)</span>
model_data <span class="token operator">=</span> <span class="token string">&quot;s3://sagemaker-us-west-2-565094796913/boston-xgboost-HL/output/xgboost-2021-08-31-23-02-30-970/output/model.tar.gz&quot;</span>

model <span class="token operator">=</span> Model<span class="token punctuation">(</span>image_uri<span class="token operator">=</span>image_uri<span class="token punctuation">,</span> model_data<span class="token operator">=</span>model_data<span class="token punctuation">,</span> role<span class="token operator">=</span>role<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Using this model object, we create a <strong>transformer</strong> object. This is used to perform operations on data, which in this case would be inference. We specify machine type, # of machines, and the output of where we want our transformations to go.</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>transformer <span class="token operator">=</span> model<span class="token punctuation">.</span>transformer<span class="token punctuation">(</span>
    instance_count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
    instance_type <span class="token operator">=</span> <span class="token string">&#39;ml.m4.xlarge&#39;</span><span class="token punctuation">,</span>
    output_path <span class="token operator">=</span> batch_transform_output_path
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Then, you call the transform method to do the job.</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>transformer<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>
    data<span class="token operator">=</span>data_s3_path<span class="token punctuation">,</span>
    data_type<span class="token operator">=</span><span class="token string">&#39;S3Prefix&#39;</span><span class="token punctuation">,</span>
    content_type<span class="token operator">=</span><span class="token string">&#39;text/csv&#39;</span><span class="token punctuation">,</span>
    split_type<span class="token operator">=</span><span class="token string">&#39;Line&#39;</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="aws-console" tabindex="-1"><a class="header-anchor" href="#aws-console" aria-hidden="true">#</a> AWS Console</h2>`,9);function m(h,k){const e=p("ExternalLinkIcon");return o(),r("div",null,[l,n("ul",null,[n("li",null,[a("If you want to learn more about batch transform, we recommend "),n("a",u,[a("Use Batch Transform"),i(e)])])]),d])}const v=t(c,[["render",m],["__file","03-Batch Transform.html.vue"]]);export{v as default};
